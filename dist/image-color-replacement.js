var ImageReplacer,ImageReplacerDirective;ImageReplacer=function(){function t(t){this.original=t,this.canvas=n(t),this.ctx=r(this.canvas),this.drawed=e(this.ctx,t)}var r,e,n,a,i,c;return t.original=null,t.canvas=null,c=function(t){var r,e,n,a,i;if(t=t.replace("#",""),r=[],6===t.length)for(i=[0,1,2],n=0,a=i.length;a>n;n++)e=i[n],r.push(parseInt(t.substr(2*e,2),16));return r},n=function(t){var r;return r=document.createElement("canvas"),r.width=t.width,r.height=t.height,r},r=function(t){return t?t.getContext("2d"):void 0},e=function(t,r){var e;return t.drawImage(r,0,0,r.width,r.height),e=t.getImageData(0,0,r.width,r.height)},i=function(t,r){return Math.abs(t-r)},a=function(t,r,e){return t>r?r+e>t:t>r-e},t.prototype.replaceColors=function(t){var r,e,n,a,o,l;if(t){if(t.length>0)for(e=0;e<this.drawed.data.length;){for(n=0,a=t.length;a>n;n++)o=t[n],r=c(o.from),l=c(o.to),o.tolerance||(o.tolerance=10),i(this.drawed.data[e+0],r[0])<=o.tolerance&&i(this.drawed.data[e+1],r[1])<=o.tolerance&&i(this.drawed.data[e+2],r[2])<=o.tolerance&&(this.drawed.data[e+0]=l[0],this.drawed.data[e+1]=l[1],this.drawed.data[e+2]=l[2]);e+=4}this.ctx.putImageData(this.drawed,0,0)}return!0},t.prototype.replaceHex=function(t){var r,e,n,a;if(r=[],t)for(n=0,a=t.length;a>n;n++)e=t[n],r.push([c(e.from),c(e.to)]);return r},t.prototype.toDataURL=function(t){var r;return null==t&&(t="image/png"),r=this.canvas.toDataURL(t),this.original=null,this.canvas=null,this.ctx=null,this.drawed=null,r},t}(),"undefined"!=typeof angular&&null!==angular&&(ImageReplacerDirective=function(){function t(){var t;return t={restrict:"A",link:r,scope:{colorReplace:"=",ngSrc:"@?"}}}var r,e;return r=function(t,r,n,a){return this.original=new Image,null!=r[0].src&&(this.original.src=r[0].src,e(this.original,t.colorReplace,r[0])),null!=t.ngSrc&&t.$watch("ngSrc",function(r){return function(e,n){return null!=e?r.original.src=t.ngSrc:void 0}}(this)),t.$watch("colorReplace",function(t){return function(n,a){return null!=n&&null!=t.original.src?e(t.original,n,r[0]):void 0}}(this),!0)},e=function(t,r,e){var n;return e.classList.toggle("loading"),n=new Image,n.crossOrigin="anonymous",n.onload=function(t){return function(){var t;return t=new ImageReplacer(n),t.replaceColors(r),e.src=t.toDataURL(),e.classList.remove("loading")}}(this),n.src=t.src},t}(),ImageReplacerDirective.$inject=[],angular.module("color-replace",[]),angular.module("color-replace").directive("colorReplace",ImageReplacerDirective));