var ImageReplacer,ImageReplacerDirective;ImageReplacer=function(){function r(r){this.original=r,this.canvas=n(r),this.ctx=t(this.canvas),this.drawed=e(this.ctx,r)}var t,e,n,a,i,l;return r.original=null,r.canvas=null,l=function(r){var t,e,n,a,i;if(r=r.replace("#",""),t=[],6===r.length)for(i=[0,1,2],n=0,a=i.length;a>n;n++)e=i[n],t.push(parseInt(r.substr(2*e,2),16));return t},n=function(r){var t;return t=document.createElement("canvas"),t.width=r.width,t.height=r.height,t},t=function(r){return r?r.getContext("2d"):void 0},e=function(r,t){var e;return r.drawImage(t,0,0,t.width,t.height),e=r.getImageData(0,0,t.width,t.height)},i=function(r,t){return Math.abs(r-t)},a=function(r,t,e){return r>t?t+e>r:r>t-e},r.prototype.replaceColors=function(r){var t,e,n,a,o,c;if(r){if(r.length>0)for(e=0;e<this.drawed.data.length;){for(n=0,a=r.length;a>n;n++)o=r[n],t=l(o.from),c=l(o.to),o.tolerance||(o.tolerance=10),i(this.drawed.data[e+0],t[0])<=o.tolerance&&i(this.drawed.data[e+1],t[1])<=o.tolerance&&i(this.drawed.data[e+2],t[2])<=o.tolerance&&(this.drawed.data[e+0]=c[0],this.drawed.data[e+1]=c[1],this.drawed.data[e+2]=c[2]);e+=4}this.ctx.putImageData(this.drawed,0,0)}return!0},r.prototype.replaceHex=function(r){var t,e,n,a;if(t=[],r)for(n=0,a=r.length;a>n;n++)e=r[n],t.push([l(e.from),l(e.to)]);return t},r.prototype.toDataURL=function(r){var t;return null==r&&(r="image/png"),t=this.canvas.toDataURL(r),this.original=null,this.canvas=null,this.ctx=null,this.drawed=null,t},r}(),"undefined"!=typeof angular&&null!==angular&&(ImageReplacerDirective=function(){function r(){var r;return r={restrict:"A",link:t,scope:{colorReplace:"=",ngSrc:"@?"}}}var t,e;return t=function(r,t,n,a){return this.original=new Image,null!=t[0].src&&(this.original.src=t[0].src,e(this.original,r.colorReplace,t[0])),null!=r.ngSrc&&r.$watch("ngSrc",function(n){return function(a,i){return null!=a?(n.original.src=r.ngSrc,e(n.original,r.colorReplace,t[0])):void 0}}(this)),r.$watch("colorReplace",function(r){return function(n,a){return null!=n&&null!=r.original.src?e(r.original,n,t[0]):void 0}}(this),!0)},e=function(r,t,e){var n;return e.classList.toggle("loading"),n=new Image,n.crossOrigin="anonymous",n.onload=function(r){return function(){var r;return r=new ImageReplacer(n),r.replaceColors(t),e.src=r.toDataURL(),l.classList.remove("loading")}}(this),n.src=r.src},r}(),ImageReplacerDirective.$inject=[],angular.module("color-replace",[]),angular.module("color-replace").directive("colorReplace",ImageReplacerDirective));